version: v1.0
name: Deploy

agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804

blocks:
  - name: Deploy
    task:
      secrets:
        - name: netlify-auth
        - name: netlify-site-id-iiro-fi
      prologue:
        commands:
          - nvm install --lts
          - sem-version node --lts
          - npm i -g npm netlify-cli
      jobs:
        - name: Netlify
          commands:
            - checkout
            - cache restore build-lambda-$SEMAPHORE_PIPELINE_ID
            - cache restore build-public-$SEMAPHORE_PIPELINE_ID
            - netlify deploy -p -d public -f lambda -m "$TRAVIS_TAG"
